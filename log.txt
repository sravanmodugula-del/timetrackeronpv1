# FMB TimeTracker Simple Deployment Script
param(
    [string]$InstallPath = "C:\fmb-timetracker"
)

Write-Host "üöÄ FMB TimeTracker Deployment" -ForegroundColor Green

# Check admin privileges
if (-NOT ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] "Administrator")) {
    Write-Host "‚ùå Run as Administrator" -ForegroundColor Red
    exit 1
}

# Create logs directory
if (-not (Test-Path "$InstallPath\logs")) {
    New-Item -ItemType Directory -Path "$InstallPath\logs" -Force | Out-Null
}

# Check .env file
if (-not (Test-Path ".env")) {
    if (Test-Path "fmb-onprem/.env.fmb-onprem") {
        Copy-Item "fmb-onprem/.env.fmb-onprem" ".env"
        Write-Host "‚úÖ Environment file copied" -ForegroundColor Green
    } else {
        Write-Host "‚ùå No .env file found" -ForegroundColor Red
        exit 1
    }
}

# Stop existing processes
Write-Host "‚èπÔ∏è Stopping application..." -ForegroundColor Yellow
npx pm2 delete fmb-timetracker 2>$null

# Install dependencies
Write-Host "üì¶ Installing dependencies..." -ForegroundColor Yellow
npm install --legacy-peer-deps

# Build application
Write-Host "üî® Building..." -ForegroundColor Yellow
npm run build

if (-not (Test-Path "dist/index.js")) {
    Write-Host "‚ùå Build failed" -ForegroundColor Red
    exit 1
}

# Start application
Write-Host "‚ñ∂Ô∏è Starting application..." -ForegroundColor Yellow
npx pm2 start ecosystem.config.cjs

# Wait and check status
Start-Sleep -Seconds 15
$status = npx pm2 jlist | ConvertFrom-Json
$app = $status | Where-Object { $_.name -eq "fmb-timetracker" }

if ($app -and $app.pm2_env.status -eq "online") {
    Write-Host "‚úÖ Deployment successful!" -ForegroundColor Green
    Write-Host "üåê Check: http://localhost:3000" -ForegroundColor Green
    
    # Health check
    Start-Sleep -Seconds 5
    try {
        $response = Invoke-WebRequest -Uri "http://localhost:3000/health" -UseBasicParsing -TimeoutSec 10
        if ($response.StatusCode -eq 200) {
            Write-Host "‚úÖ Health check passed" -ForegroundColor Green
        }
    } catch {
        Write-Host "‚ö†Ô∏è Health check failed - check logs" -ForegroundColor Yellow
    }
} else {
    Write-Host "‚ùå Deployment failed" -ForegroundColor Red
    npx pm2 logs fmb-timetracker --lines 10
    exit 1
}

Write-Host "üìã Commands: npx pm2 status | npx pm2 logs" -ForegroundColor Cyan


2025-09-02T14:56:38: 2025-09-02T21:56:38.315Z üü¢ [SERVER] Starting FMB TimeTracker On-Premises Application...
2025-09-02T14:56:38: [dotenv@17.2.1] injecting env (0) from fmb-onprem\.env.fmb-onprem -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
2025-09-02T14:56:38: [dotenv@17.2.1] injecting env (23) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
2025-09-02T14:56:38: üè¢ FMB On-Premises configuration loaded
2025-09-02T14:56:38: üîç [FMB-CONFIG] Looking for certificate at: C:\fmb-timetracker\saml_cert.pem
2025-09-02T14:56:38: ‚úÖ [FMB-CONFIG] Certificate loaded successfully from: C:\fmb-timetracker\saml_cert.pem
2025-09-02T14:56:38: üîç [FMB-CONFIG] Certificate length: 1004 characters
2025-09-02T14:56:38: 2025-09-02T21:56:38.322Z üü¢ [FMB-ONPREM] FMB On-premises environment initialized
2025-09-02T14:56:38: 2025-09-02T21:56:38.322Z üü¢ [CONFIG] FMB session secret validated successfully
2025-09-02T14:56:38: üîó Connecting to FMB MS SQL database...
2025-09-02T14:56:38: ‚úÖ FMB Database connection established successfully
2025-09-02T14:56:38: 2025-09-02T21:56:38.424Z üü¢ [DATABASE] FMB Database initialization completed successfully
2025-09-02T14:56:38: 2025-09-02T21:56:38.428Z üü¢ [SESSION] FMB Enterprise Session configured for production mode
2025-09-02T14:56:38: 2025-09-02T21:56:38.428Z üü¢ [SESSION] Using memory session store for development/testing
2025-09-02T14:56:38: Warning: connect.session() MemoryStore is not
2025-09-02T14:56:38: designed for a production environment, as it will leak
2025-09-02T14:56:38: memory, and will not scale past a single process.
2025-09-02T14:56:38: 2025-09-02T21:56:38.428Z üü¢ [SESSION] Session store initialization completed
2025-09-02T14:56:38: 2025-09-02T21:56:38.428Z üü¢ [SERVER] FMB Session middleware configured successfully
2025-09-02T14:56:38: 2025-09-02T21:56:38.431Z üü¢ [SECURITY] Enterprise session security middleware activated
2025-09-02T14:56:38: üöÄ Setting up FMB SAML Authentication for On-Premises environment...
2025-09-02T14:56:38: 2025-09-02T21:56:38.434Z üîµ [FMB-SAML] Initializing FMB SAML Authentication
2025-09-02T14:56:38: üîß [FMB-DATABASE] Creating new FMB storage instance...
2025-09-02T14:56:38: [dotenv@17.2.1] injecting env (0) from fmb-onprem\.env.fmb-onprem -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
2025-09-02T14:56:38: [dotenv@17.2.1] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
2025-09-02T14:56:38: üè¢ FMB On-Premises configuration loaded
2025-09-02T14:56:38: üîç [FMB-CONFIG] Looking for certificate at: C:\fmb-timetracker\saml_cert.pem
2025-09-02T14:56:38: ‚úÖ [FMB-CONFIG] Certificate loaded successfully from: C:\fmb-timetracker\saml_cert.pem
2025-09-02T14:56:38: üîç [FMB-CONFIG] Certificate length: 1004 characters
2025-09-02T14:56:38: üîó [FMB-STORAGE] Connecting to FMB MS SQL Server...
2025-09-02T14:56:38: 2025-09-02T21:56:38.437Z üü¢ [FMB-SAML] SAML Certificate validation {
2025-09-02T14:56:38:   "certLength": 1004,
2025-09-02T14:56:38:   "hasBeginMarker": true,
2025-09-02T14:56:38:   "hasEndMarker": true
2025-09-02T14:56:38: }
2025-09-02T14:56:38: 2025-09-02T21:56:38.439Z üîµ [FMB-SAML] FMB SAML Authentication setup completed
2025-09-02T14:56:38: üõ°Ô∏è [SESSION-MGMT] Enterprise session management routes registered
2025-09-02T14:56:38: üõ°Ô∏è [SESSION-MGMT] Enterprise session management routes registered
2025-09-02T14:56:38: 2025-09-02T21:56:38.443Z üü¢ [SERVER] FMB TimeTracker running on http://0.0.0.0:3000
2025-09-02T14:56:38: 2025-09-02T21:56:38.443Z üü¢ [SERVER] Environment: fmb-onprem
2025-09-02T14:56:38: 2025-09-02T21:56:38.444Z üü¢ [FMB-ONPREM] On-premises deployment active - SAML authentication enabled
2025-09-02T14:56:38: 2025-09-02T21:56:38.511Z üóÑÔ∏è [FMB-STORAGE] CONNECT: Successfully connected to MS SQL Server
2025-09-02T14:57:01: 2025-09-02T21:57:01.124Z üîµ [FMB-SAML] SAML ACS callback received - IdP-initiated flow {
2025-09-02T14:57:01:   "ip": "192.168.209.85:63610",
2025-09-02T14:57:01:   "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36 Edg/139.0.0.0",
2025-09-02T14:57:01:   "timestamp": "2025-09-02T21:57:01.124Z",
2025-09-02T14:57:01:   "hasBody": true,
2025-09-02T14:57:01:   "bodyKeys": [
2025-09-02T14:57:01:     "SAMLResponse"
2025-09-02T14:57:01:   ],
2025-09-02T14:57:01:   "headers": {
2025-09-02T14:57:01:     "content-type": "application/x-www-form-urlencoded",
2025-09-02T14:57:01:     "content-length": "8093"
2025-09-02T14:57:01:   }
2025-09-02T14:57:01: }
2025-09-02T14:57:01: 2025-09-02T21:57:01.204Z üîµ [FMB-SAML] SAML profile received {
2025-09-02T14:57:01:   "nameID": "Sravan.Modugula@fmb.com",
2025-09-02T14:57:01:   "email": "Sravan.Modugula@fmb.com",
2025-09-02T14:57:01:   "firstName": "Sravan",
2025-09-02T14:57:01:   "lastName": "Modugula"
2025-09-02T14:57:01: }
2025-09-02T14:57:01: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:01: 2025-09-02T21:57:01.317Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850221204-kq0tvg', recordCount: 1 }
2025-09-02T14:57:01: üîÑ [SQL] 
2025-09-02T14:57:01:  operation on users
2025-09-02T14:57:01: üóÑÔ∏è [SQL] Executing with 7 parameters
2025-09-02T14:57:01: ‚úÖ [SQL] Operation completed: 1 rows affected
2025-09-02T14:57:01: 2025-09-02T21:57:01.366Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850221318-he25gd', recordCount: 0 }
2025-09-02T14:57:01: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:01: 2025-09-02T21:57:01.398Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850221366-07skfg', recordCount: 1 }
2025-09-02T14:57:01: 2025-09-02T21:57:01.398Z üîµ [FMB-SAML] User upserted in database {
2025-09-02T14:57:01:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:01: }
2025-09-02T14:57:01: 2025-09-02T21:57:01.399Z üîµ [FMB-SAML] User authenticated and stored {
2025-09-02T14:57:01:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:01: }
2025-09-02T14:57:01: 2025-09-02T21:57:01.400Z üü¢ [FMB-SAML] Serializing user for session {
2025-09-02T14:57:01:   "userId": "user-1756847838064",
2025-09-02T14:57:01:   "timestamp": "2025-09-02T21:57:01.400Z",
2025-09-02T14:57:01:   "source": "saml"
2025-09-02T14:57:01: }
2025-09-02T14:57:01: üîµ [FMB-SAML] User session established and saved: Sravan.Modugula@fmb.com
2025-09-02T14:57:01: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:01: 2025-09-02T21:57:01.477Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850221447-6077bg', recordCount: 1 }
2025-09-02T14:57:01: 2025-09-02T21:57:01.477Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:01:   "userId": "user-1756847838064",
2025-09-02T14:57:01:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:01: }
2025-09-02T14:57:01: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:01: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:01: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:01: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:01: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:01: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:01: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:01: 2025-09-02T21:57:01.612Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850221571-5u3neg', recordCount: 1 }
2025-09-02T14:57:01: 2025-09-02T21:57:01.613Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:01:   "userId": "user-1756847838064",
2025-09-02T14:57:01:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:01: }
2025-09-02T14:57:01: 2025-09-02T21:57:01.646Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850221577-hoqukt', recordCount: 1 }
2025-09-02T14:57:01: 2025-09-02T21:57:01.646Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:01:   "userId": "user-1756847838064",
2025-09-02T14:57:01:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:01: }
2025-09-02T14:57:01: 2025-09-02T21:57:01.673Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850221585-pkq611', recordCount: 1 }
2025-09-02T14:57:01: 2025-09-02T21:57:01.674Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:01:   "userId": "user-1756847838064",
2025-09-02T14:57:01:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:01: }
2025-09-02T14:57:01: 2025-09-02T21:57:01.683Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850221586-d8kgxi', recordCount: 1 }
2025-09-02T14:57:01: 2025-09-02T21:57:01.684Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:01:   "userId": "user-1756847838064",
2025-09-02T14:57:01:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:01: }
2025-09-02T14:57:01: 2025-09-02T21:57:01.686Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850221586-fe1pdd', recordCount: 1 }
2025-09-02T14:57:01: 2025-09-02T21:57:01.686Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:01:   "userId": "user-1756847838064",
2025-09-02T14:57:01:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:01: }
2025-09-02T14:57:01: 2025-09-02T21:57:01.692Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850221587-x1b10g', recordCount: 1 }
2025-09-02T14:57:01: 2025-09-02T21:57:01.693Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:01:   "userId": "user-1756847838064",
2025-09-02T14:57:01:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:01: }
2025-09-02T14:57:01: 2025-09-02T21:57:01.696Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850221587-wokfwr', recordCount: 1 }
2025-09-02T14:57:01: 2025-09-02T21:57:01.696Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:01:   "userId": "user-1756847838064",
2025-09-02T14:57:01:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:01: }
2025-09-02T14:57:01: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:01: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:01: 2025-09-02T21:57:01.883Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850221852-ruhxdc', recordCount: 1 }
2025-09-02T14:57:01: 2025-09-02T21:57:01.883Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:01:   "userId": "user-1756847838064",
2025-09-02T14:57:01:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:01: }
2025-09-02T14:57:01: 2025-09-02T21:57:01.884Z üü¢ [FMB-SAML] FMB Authentication check for GET /api/auth/user {
2025-09-02T14:57:01:   "ip": "192.168.209.85:63610",
2025-09-02T14:57:01:   "sessionId": "b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e",
2025-09-02T14:57:01:   "isAuthenticated": true
2025-09-02T14:57:01: }
2025-09-02T14:57:01: 2025-09-02T21:57:01.884Z üü¢ [FMB-SAML] FMB Authentication successful {
2025-09-02T14:57:01:   "userId": "user-1756847838064",
2025-09-02T14:57:01:   "sessionId": "b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e"
2025-09-02T14:57:01: }
2025-09-02T14:57:01: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:01: 2025-09-02T21:57:01.909Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850221879-gtb3e2', recordCount: 1 }
2025-09-02T14:57:01: 2025-09-02T21:57:01.910Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:01:   "userId": "user-1756847838064",
2025-09-02T14:57:01:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:01: }
2025-09-02T14:57:01: 2025-09-02T21:57:01.913Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850221884-ddy72d', recordCount: 1 }
2025-09-02T14:57:01: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:01: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:01: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:01: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:01: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:02: 2025-09-02T21:57:02.013Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850221985-sq1qq7', recordCount: 1 }
2025-09-02T14:57:02: 2025-09-02T21:57:02.013Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:02:   "userId": "user-1756847838064",
2025-09-02T14:57:02:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:02: }
2025-09-02T14:57:02: 2025-09-02T21:57:02.014Z üü¢ [FMB-SAML] FMB Authentication check for GET /api/auth/user {
2025-09-02T14:57:02:   "ip": "192.168.209.85:63610",
2025-09-02T14:57:02:   "sessionId": "b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e",
2025-09-02T14:57:02:   "isAuthenticated": true
2025-09-02T14:57:02: }
2025-09-02T14:57:02: 2025-09-02T21:57:02.014Z üü¢ [FMB-SAML] FMB Authentication successful {
2025-09-02T14:57:02:   "userId": "user-1756847838064",
2025-09-02T14:57:02:   "sessionId": "b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e"
2025-09-02T14:57:02: }
2025-09-02T14:57:02: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:02: 2025-09-02T21:57:02.016Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850221987-ht69dw', recordCount: 1 }
2025-09-02T14:57:02: 2025-09-02T21:57:02.016Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:02:   "userId": "user-1756847838064",
2025-09-02T14:57:02:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:02: }
2025-09-02T14:57:02: 2025-09-02T21:57:02.016Z üü¢ [FMB-SAML] FMB Authentication check for GET /api/organizations {
2025-09-02T14:57:02:   "ip": "192.168.209.85:63610",
2025-09-02T14:57:02:   "sessionId": "b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e",
2025-09-02T14:57:02:   "isAuthenticated": true
2025-09-02T14:57:02: }
2025-09-02T14:57:02: 2025-09-02T21:57:02.017Z üü¢ [FMB-SAML] FMB Authentication successful {
2025-09-02T14:57:02:   "userId": "user-1756847838064",
2025-09-02T14:57:02:   "sessionId": "b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e"
2025-09-02T14:57:02: }
2025-09-02T14:57:02: 2025-09-02T21:57:02.017Z üóÑÔ∏è [FMB-STORAGE] GET_USER_ORGS: Fetching organizations for user { userId: 'user-1756847838064' }
2025-09-02T14:57:02: 2025-09-02T21:57:02.019Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850221990-p2aqpr', recordCount: 1 }
2025-09-02T14:57:02: 2025-09-02T21:57:02.019Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:02:   "userId": "user-1756847838064",
2025-09-02T14:57:02:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:02: }
2025-09-02T14:57:02: 2025-09-02T21:57:02.019Z üü¢ [FMB-SAML] FMB Authentication check for GET /api/dashboard/stats {
2025-09-02T14:57:02:   "ip": "192.168.209.85:63610",
2025-09-02T14:57:02:   "sessionId": "b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e",
2025-09-02T14:57:02:   "isAuthenticated": true
2025-09-02T14:57:02: }
2025-09-02T14:57:02: 2025-09-02T21:57:02.019Z üü¢ [FMB-SAML] FMB Authentication successful {
2025-09-02T14:57:02:   "userId": "user-1756847838064",
2025-09-02T14:57:02:   "sessionId": "b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e"
2025-09-02T14:57:02: }
2025-09-02T14:57:02: üóÑÔ∏è [SQL] Executing with 3 parameters
2025-09-02T14:57:02: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:02: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:02: 2025-09-02T21:57:02.023Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850221993-j0i27q', recordCount: 1 }
2025-09-02T14:57:02: 2025-09-02T21:57:02.023Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:02:   "userId": "user-1756847838064",
2025-09-02T14:57:02:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:02: }
2025-09-02T14:57:02: 2025-09-02T21:57:02.023Z üü¢ [FMB-SAML] FMB Authentication check for GET /api/dashboard/project-breakdown {
2025-09-02T14:57:02:   "ip": "192.168.209.85:63610",
2025-09-02T14:57:02:   "sessionId": "b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e",
2025-09-02T14:57:02:   "isAuthenticated": true
2025-09-02T14:57:02: }
2025-09-02T14:57:02: 2025-09-02T21:57:02.023Z üü¢ [FMB-SAML] FMB Authentication successful {
2025-09-02T14:57:02:   "userId": "user-1756847838064",
2025-09-02T14:57:02:   "sessionId": "b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e"
2025-09-02T14:57:02: }
2025-09-02T14:57:02: 2025-09-02T21:57:02.025Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850221994-rgoze7', recordCount: 1 }
2025-09-02T14:57:02: 2025-09-02T21:57:02.025Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:02:   "userId": "user-1756847838064",
2025-09-02T14:57:02:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:02: }
2025-09-02T14:57:02: 2025-09-02T21:57:02.025Z üü¢ [FMB-SAML] FMB Authentication check for GET /api/dashboard/recent-activity {
2025-09-02T14:57:02:   "ip": "192.168.209.85:63610",
2025-09-02T14:57:02:   "sessionId": "b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e",
2025-09-02T14:57:02:   "isAuthenticated": true
2025-09-02T14:57:02: }
2025-09-02T14:57:02: 2025-09-02T21:57:02.026Z üü¢ [FMB-SAML] FMB Authentication successful {
2025-09-02T14:57:02:   "userId": "user-1756847838064",
2025-09-02T14:57:02:   "sessionId": "b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e"
2025-09-02T14:57:02: }
2025-09-02T14:57:02: 2025-09-02T21:57:02.043Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850222014-lmc8w8', recordCount: 1 }
2025-09-02T14:57:02: 2025-09-02T21:57:02.047Z üóÑÔ∏è [FMB-STORAGE] GET_USER_ORGS: User organizations fetched successfully { userId: 'user-1756847838064', count: 1 }
2025-09-02T14:57:02: 2025-09-02T21:57:02.050Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850222020-70rpyq', recordCount: 1 }
2025-09-02T14:57:02: 2025-09-02T21:57:02.051Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850222020-6zcdf6', recordCount: 1 }
2025-09-02T14:57:02: 2025-09-02T21:57:02.053Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850222020-y6s65g', recordCount: 1 }
2025-09-02T14:57:03: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:03: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:03: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:03: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:03: 2025-09-02T21:57:03.623Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850223593-s38eoy', recordCount: 1 }
2025-09-02T14:57:03: 2025-09-02T21:57:03.623Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:03:   "userId": "user-1756847838064",
2025-09-02T14:57:03:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:03: }
2025-09-02T14:57:03: 2025-09-02T21:57:03.624Z üü¢ [FMB-SAML] FMB Authentication check for GET /api/auth/user {
2025-09-02T14:57:03:   "ip": "192.168.209.85:63610",
2025-09-02T14:57:03:   "sessionId": "b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e",
2025-09-02T14:57:03:   "isAuthenticated": true
2025-09-02T14:57:03: }
2025-09-02T14:57:03: 2025-09-02T21:57:03.624Z üü¢ [FMB-SAML] FMB Authentication successful {
2025-09-02T14:57:03:   "userId": "user-1756847838064",
2025-09-02T14:57:03:   "sessionId": "b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e"
2025-09-02T14:57:03: }
2025-09-02T14:57:03: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:03: 2025-09-02T21:57:03.627Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850223595-oiurca', recordCount: 1 }
2025-09-02T14:57:03: 2025-09-02T21:57:03.628Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:03:   "userId": "user-1756847838064",
2025-09-02T14:57:03:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:03: }
2025-09-02T14:57:03: 2025-09-02T21:57:03.628Z üü¢ [FMB-SAML] FMB Authentication check for GET /api/organizations {
2025-09-02T14:57:03:   "ip": "192.168.209.85:63610",
2025-09-02T14:57:03:   "sessionId": "b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e",
2025-09-02T14:57:03:   "isAuthenticated": true
2025-09-02T14:57:03: }
2025-09-02T14:57:03: 2025-09-02T21:57:03.628Z üü¢ [FMB-SAML] FMB Authentication successful {
2025-09-02T14:57:03:   "userId": "user-1756847838064",
2025-09-02T14:57:03:   "sessionId": "b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e"
2025-09-02T14:57:03: }
2025-09-02T14:57:03: 2025-09-02T21:57:03.628Z üóÑÔ∏è [FMB-STORAGE] GET_USER_ORGS: Fetching organizations for user { userId: 'user-1756847838064' }
2025-09-02T14:57:03: 2025-09-02T21:57:03.630Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850223597-pzcwei', recordCount: 1 }
2025-09-02T14:57:03: 2025-09-02T21:57:03.630Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:03:   "userId": "user-1756847838064",
2025-09-02T14:57:03:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:03: }
2025-09-02T14:57:03: 2025-09-02T21:57:03.630Z üü¢ [FMB-SAML] FMB Authentication check for GET /api/projects {
2025-09-02T14:57:03:   "ip": "192.168.209.85:63610",
2025-09-02T14:57:03:   "sessionId": "b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e",
2025-09-02T14:57:03:   "isAuthenticated": true
2025-09-02T14:57:03: }
2025-09-02T14:57:03: 2025-09-02T21:57:03.630Z üü¢ [FMB-SAML] FMB Authentication successful {
2025-09-02T14:57:03:   "userId": "user-1756847838064",
2025-09-02T14:57:03:   "sessionId": "b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e"
2025-09-02T14:57:03: }
2025-09-02T14:57:03: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:03: 2025-09-02T21:57:03.647Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850223618-dkq4od', recordCount: 1 }
2025-09-02T14:57:03: 2025-09-02T21:57:03.647Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:03:   "userId": "user-1756847838064",
2025-09-02T14:57:03:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:03: }
2025-09-02T14:57:03: 2025-09-02T21:57:03.653Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850223624-hq1mkt', recordCount: 1 }
2025-09-02T14:57:03: 2025-09-02T21:57:03.656Z üóÑÔ∏è [FMB-STORAGE] GET_USER_ORGS: User organizations fetched successfully { userId: 'user-1756847838064', count: 1 }
2025-09-02T14:57:03: 2025-09-02T21:57:03.659Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850223631-2goynn', recordCount: 1 }
2025-09-02T14:57:05: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:05: 2025-09-02T21:57:05.427Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850225399-998r3m', recordCount: 1 }
2025-09-02T14:57:05: 2025-09-02T21:57:05.428Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:05:   "userId": "user-1756847838064",
2025-09-02T14:57:05:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:05: }
2025-09-02T14:57:05: 2025-09-02T21:57:05.428Z üü¢ [FMB-SAML] FMB Authentication check for GET /api/projects/proj-1756847919444-2gxlcs5v0/tasks {
2025-09-02T14:57:05:   "ip": "192.168.209.85:63610",
2025-09-02T14:57:05:   "sessionId": "b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e",
2025-09-02T14:57:05:   "isAuthenticated": true
2025-09-02T14:57:05: }
2025-09-02T14:57:05: 2025-09-02T21:57:05.428Z üü¢ [FMB-SAML] FMB Authentication successful {
2025-09-02T14:57:05:   "userId": "user-1756847838064",
2025-09-02T14:57:05:   "sessionId": "b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e"
2025-09-02T14:57:05: }
2025-09-02T14:57:05: üìã [API] Fetching tasks for project: proj-1756847919444-2gxlcs5v0 user: user-1756847838064
2025-09-02T14:57:05: ‚úÖ [API] Project access verified: Replicon Replacement
2025-09-02T14:57:05: üîç [FMB-STORAGE] Fetching tasks for project: proj-1756847919444-2gxlcs5v0
2025-09-02T14:57:05: ‚úÖ [FMB-STORAGE] Found 2 tasks for project proj-1756847919444-2gxlcs5v0
2025-09-02T14:57:05: üìã [API] Raw tasks result: [
2025-09-02T14:57:05:   {
2025-09-02T14:57:05:     id: 'task-1756848248440-f8vav9zz5',
2025-09-02T14:57:05:     project_id: 'proj-1756847919444-2gxlcs5v0',
2025-09-02T14:57:05:     title: 'Quality Test',
2025-09-02T14:57:05:     description: '',
2025-09-02T14:57:05:     status: 'active',
2025-09-02T14:57:05:     priority: 'medium',
2025-09-02T14:57:05:     assigned_to: 'user-1756847838064',
2025-09-02T14:57:05:     created_by: 'user-1756847838064',
2025-09-02T14:57:05:     created_at: 2025-09-02T14:24:08.493Z,
2025-09-02T14:57:05:     updated_at: 2025-09-02T14:24:08.493Z,
2025-09-02T14:57:05:     name: 'Quality Test',
2025-09-02T14:57:05:     projectId: 'proj-1756847919444-2gxlcs5v0'
2025-09-02T14:57:05:   },
2025-09-02T14:57:05:   {
2025-09-02T14:57:05:     id: 'task-1756847930411-6l5o3ofkl',
2025-09-02T14:57:05:     project_id: 'proj-1756847919444-2gxlcs5v0',
2025-09-02T14:57:05:     title: 'Development',
2025-09-02T14:57:05:     description: '',
2025-09-02T14:57:05:     status: 'active',
2025-09-02T14:57:05:     priority: 'medium',
2025-09-02T14:57:05:     assigned_to: 'user-1756847838064',
2025-09-02T14:57:05:     created_by: 'user-1756847838064',
2025-09-02T14:57:05:     created_at: 2025-09-02T14:18:50.470Z,
2025-09-02T14:57:05:     updated_at: 2025-09-02T14:18:50.470Z,
2025-09-02T14:57:05:     name: 'Development',
2025-09-02T14:57:05:     projectId: 'proj-1756847919444-2gxlcs5v0'
2025-09-02T14:57:05:   }
2025-09-02T14:57:05: ]
2025-09-02T14:57:05: üìã [API] Found tasks for project: 2
2025-09-02T14:57:05: üìã [API] Task details: [
2025-09-02T14:57:05:   {
2025-09-02T14:57:05:     id: 'task-1756848248440-f8vav9zz5',
2025-09-02T14:57:05:     name: 'Quality Test',
2025-09-02T14:57:05:     status: 'active',
2025-09-02T14:57:05:     project_id: 'proj-1756847919444-2gxlcs5v0'
2025-09-02T14:57:05:   },
2025-09-02T14:57:05:   {
2025-09-02T14:57:05:     id: 'task-1756847930411-6l5o3ofkl',
2025-09-02T14:57:05:     name: 'Development',
2025-09-02T14:57:05:     status: 'active',
2025-09-02T14:57:05:     project_id: 'proj-1756847919444-2gxlcs5v0'
2025-09-02T14:57:05:   }
2025-09-02T14:57:05: ]
2025-09-02T14:57:05: üìã [API] Returning tasks count: 2
2025-09-02T14:57:23: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:23: 2025-09-02T21:57:23.739Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850243711-kqq17a', recordCount: 1 }
2025-09-02T14:57:23: 2025-09-02T21:57:23.740Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:23:   "userId": "user-1756847838064",
2025-09-02T14:57:23:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:23: }
2025-09-02T14:57:23: 2025-09-02T21:57:23.740Z üü¢ [FMB-SAML] FMB Authentication check for POST /api/time-entries {
2025-09-02T14:57:23:   "ip": "192.168.209.85:63610",
2025-09-02T14:57:23:   "sessionId": "b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e",
2025-09-02T14:57:23:   "isAuthenticated": true
2025-09-02T14:57:23: }
2025-09-02T14:57:23: 2025-09-02T21:57:23.740Z üü¢ [FMB-SAML] FMB Authentication successful {
2025-09-02T14:57:23:   "userId": "user-1756847838064",
2025-09-02T14:57:23:   "sessionId": "b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e"
2025-09-02T14:57:23: }
2025-09-02T14:57:23: üìù Time Entry Request Body: {
2025-09-02T14:57:23:   "projectId": "proj-1756847919444-2gxlcs5v0",
2025-09-02T14:57:23:   "taskId": "task-1756847930411-6l5o3ofkl",
2025-09-02T14:57:23:   "description": "",
2025-09-02T14:57:23:   "date": "2025-09-02",
2025-09-02T14:57:23:   "startTime": "13:57",
2025-09-02T14:57:23:   "endTime": "14:57",
2025-09-02T14:57:23:   "hours": 1,
2025-09-02T14:57:23:   "duration": 1
2025-09-02T14:57:23: }
2025-09-02T14:57:23: ‚úÖ Parsed Entry Data: {
2025-09-02T14:57:23:   "userId": "user-1756847838064",
2025-09-02T14:57:23:   "projectId": "proj-1756847919444-2gxlcs5v0",
2025-09-02T14:57:23:   "taskId": "task-1756847930411-6l5o3ofkl",
2025-09-02T14:57:23:   "description": "",
2025-09-02T14:57:23:   "hours": 1,
2025-09-02T14:57:23:   "duration": 1,
2025-09-02T14:57:23:   "date": "2025-09-02",
2025-09-02T14:57:23:   "startTime": "13:57",
2025-09-02T14:57:23:   "endTime": "14:57",
2025-09-02T14:57:23:   "status": "draft",
2025-09-02T14:57:23:   "billable": false,
2025-09-02T14:57:23:   "isBillable": false,
2025-09-02T14:57:23:   "isApproved": false,
2025-09-02T14:57:23:   "isManualEntry": true,
2025-09-02T14:57:23:   "isTimerEntry": false,
2025-09-02T14:57:23:   "isTemplate": false
2025-09-02T14:57:23: }
2025-09-02T14:57:23: üîÑ [SQL] 
2025-09-02T14:57:23:  operation on time_entries
2025-09-02T14:57:23: üóÑÔ∏è [SQL] Executing with 17 parameters
2025-09-02T14:57:23: ‚ùå [EXECUTE-exec-1756850243744-jabi2s] Query execution failed: {
2025-09-02T14:57:23:   error: "Cannot insert the value NULL into column 'user_id', table 'TimeTracker.dbo.time_entries'; column does not allow nulls. INSERT fails.",
2025-09-02T14:57:23:   code: 'EREQUEST',
2025-09-02T14:57:23:   number: 515,
2025-09-02T14:57:23:   severity: 16,
2025-09-02T14:57:23:   state: 2,
2025-09-02T14:57:23:   procedure: '',
2025-09-02T14:57:23:   lineNumber: 2,
2025-09-02T14:57:23:   query: '\n' +
2025-09-02T14:57:23:     '      INSERT INTO time_entries (id, user_id, project_id, task_id, description, hours,\n' +
2025-09-02T14:57:23:     '                               duration, date, start_time, end_time, status, billable,\n' +
2025-09-02T14:57:23:     '                          ',
2025-09-02T14:57:23:   paramCount: 17,
2025-09-02T14:57:23:   paramValues: [
2025-09-02T14:57:23:     'te-1756850243744-r1lvlhefc',
2025-09-02T14:57:23:     undefined,
2025-09-02T14:57:23:     undefined,
2025-09-02T14:57:23:     undefined,
2025-09-02T14:57:23:     '',
2025-09-02T14:57:23:     1,
2025-09-02T14:57:23:     1,
2025-09-02T14:57:23:     '2025-09-02',
2025-09-02T14:57:23:     undefined,
2025-09-02T14:57:23:     undefined,
2025-09-02T14:57:23:     'draft',
2025-09-02T14:57:23:     false,
2025-09-02T14:57:23:     false,
2025-09-02T14:57:23:     false,
2025-09-02T14:57:23:     true,
2025-09-02T14:57:23:     false,
2025-09-02T14:57:23:     false
2025-09-02T14:57:23:   ]
2025-09-02T14:57:23: }
2025-09-02T14:57:23: 2025-09-02T21:57:23.776Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query execution failed {
2025-09-02T14:57:23:   executeId: 'exec-1756850243744-jabi2s',
2025-09-02T14:57:23:   error: "Cannot insert the value NULL into column 'user_id', table 'TimeTracker.dbo.time_entries'; column does not allow nulls. INSERT fails.",
2025-09-02T14:57:23:   code: 'EREQUEST',
2025-09-02T14:57:23:   query: '\n' +
2025-09-02T14:57:23:     '      INSERT INTO time_entries (id, user_id, project_id, task_id, description, hours,\n' +
2025-09-02T14:57:23:     '             ...'
2025-09-02T14:57:23: }
2025-09-02T14:57:23: Error creating time entry: RequestError: Cannot insert the value NULL into column 'user_id', table 'TimeTracker.dbo.time_entries'; column does not allow nulls. INSERT fails.
2025-09-02T14:57:23:     at handleError (C:\fmb-timetracker\node_modules\mssql\lib\tedious\request.js:384:15)
2025-09-02T14:57:23:     at Connection.emit (node:events:518:28)
2025-09-02T14:57:23:     at Connection.emit (C:\fmb-timetracker\node_modules\tedious\lib\connection.js:970:18)
2025-09-02T14:57:23:     at RequestTokenHandler.onErrorMessage (C:\fmb-timetracker\node_modules\tedious\lib\token\handler.js:284:21)
2025-09-02T14:57:23:     at Readable.<anonymous> (C:\fmb-timetracker\node_modules\tedious\lib\token\token-stream-parser.js:19:33)
2025-09-02T14:57:23:     at Readable.emit (node:events:518:28)
2025-09-02T14:57:23:     at addChunk (node:internal/streams/readable:561:12)
2025-09-02T14:57:23:     at readableAddChunkPushObjectMode (node:internal/streams/readable:538:3)
2025-09-02T14:57:23:     at Readable.push (node:internal/streams/readable:393:5)
2025-09-02T14:57:23:     at nextAsync (node:internal/streams/from:194:22) {
2025-09-02T14:57:23:   code: 'EREQUEST',
2025-09-02T14:57:23:   originalError: Error: Cannot insert the value NULL into column 'user_id', table 'TimeTracker.dbo.time_entries'; column does not allow nulls. INSERT fails.
2025-09-02T14:57:23:       at handleError (C:\fmb-timetracker\node_modules\mssql\lib\tedious\request.js:382:19)
2025-09-02T14:57:23:       at Connection.emit (node:events:518:28)
2025-09-02T14:57:23:       at Connection.emit (C:\fmb-timetracker\node_modules\tedious\lib\connection.js:970:18)
2025-09-02T14:57:23:       at RequestTokenHandler.onErrorMessage (C:\fmb-timetracker\node_modules\tedious\lib\token\handler.js:284:21)
2025-09-02T14:57:23:       at Readable.<anonymous> (C:\fmb-timetracker\node_modules\tedious\lib\token\token-stream-parser.js:19:33)
2025-09-02T14:57:23:       at Readable.emit (node:events:518:28)
2025-09-02T14:57:23:       at addChunk (node:internal/streams/readable:561:12)
2025-09-02T14:57:23:       at readableAddChunkPushObjectMode (node:internal/streams/readable:538:3)
2025-09-02T14:57:23:       at Readable.push (node:internal/streams/readable:393:5)
2025-09-02T14:57:23:       at nextAsync (node:internal/streams/from:194:22) {
2025-09-02T14:57:23:     info: ErrorMessageToken {
2025-09-02T14:57:23:       name: 'ERROR',
2025-09-02T14:57:23:       handlerName: 'onErrorMessage',
2025-09-02T14:57:23:       number: 515,
2025-09-02T14:57:23:       state: 2,
2025-09-02T14:57:23:       class: 16,
2025-09-02T14:57:23:       message: "Cannot insert the value NULL into column 'user_id', table 'TimeTracker.dbo.time_entries'; column does not allow nulls. INSERT fails.",
2025-09-02T14:57:23:       serverName: 'FMB-SQLTST20-LV',
2025-09-02T14:57:23:       procName: '',
2025-09-02T14:57:23:       lineNumber: 2
2025-09-02T14:57:23:     }
2025-09-02T14:57:23:   },
2025-09-02T14:57:23:   number: 515,
2025-09-02T14:57:23:   lineNumber: 2,
2025-09-02T14:57:23:   state: 2,
2025-09-02T14:57:23:   class: 16,
2025-09-02T14:57:23:   serverName: 'FMB-SQLTST20-LV',
2025-09-02T14:57:23:   procName: '',
2025-09-02T14:57:23:   precedingErrors: []
2025-09-02T14:57:23: }
2025-09-02T14:57:23: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:23: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:23: 2025-09-02T21:57:23.848Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850243818-dwembu', recordCount: 1 }
2025-09-02T14:57:23: 2025-09-02T21:57:23.848Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:23:   "userId": "user-1756847838064",
2025-09-02T14:57:23:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:23: }
2025-09-02T14:57:23: 2025-09-02T21:57:23.801Z üî¥ [FRONTEND-API] Request rmso00azw exception {
2025-09-02T14:57:23:   data: {
2025-09-02T14:57:23:     requestId: 'rmso00azw',
2025-09-02T14:57:23:     method: 'POST',
2025-09-02T14:57:23:     url: '/api/time-entries',
2025-09-02T14:57:23:     error: {
2025-09-02T14:57:23:       name: 'Error',
2025-09-02T14:57:23:       message: 'Failed to create time entry',
2025-09-02T14:57:23:       stack: 'Error: Failed to create time entry\n' +
2025-09-02T14:57:23:         '    at fe (https://timetracker.fmb.com/assets/index-DPbIIDG1.js:1:3142)'
2025-09-02T14:57:23:     }
2025-09-02T14:57:23:   },
2025-09-02T14:57:23:   url: 'https://timetracker.fmb.com/time-entry',
2025-09-02T14:57:23:   userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36 Edg/139.0.0.0',
2025-09-02T14:57:23:   ip: '192.168.209.85:63610',
2025-09-02T14:57:23:   sessionId: 'b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e'
2025-09-02T14:57:23: }
2025-09-02T14:57:23: 2025-09-02T21:57:23.851Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850243822-hua4rx', recordCount: 1 }
2025-09-02T14:57:23: 2025-09-02T21:57:23.852Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:23:   "userId": "user-1756847838064",
2025-09-02T14:57:23:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:23: }
2025-09-02T14:57:23: 2025-09-02T21:57:23.800Z üî¥ [FRONTEND-API] Request rmso00azw failed {
2025-09-02T14:57:23:   data: {
2025-09-02T14:57:23:     requestId: 'rmso00azw',
2025-09-02T14:57:23:     method: 'POST',
2025-09-02T14:57:23:     url: '/api/time-entries',
2025-09-02T14:57:23:     status: 500,
2025-09-02T14:57:23:     error: { message: 'Failed to create time entry' },
2025-09-02T14:57:23:     duration: '109ms'
2025-09-02T14:57:23:   },
2025-09-02T14:57:23:   url: 'https://timetracker.fmb.com/time-entry',
2025-09-02T14:57:23:   userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36 Edg/139.0.0.0',
2025-09-02T14:57:23:   ip: '192.168.209.85:63610',
2025-09-02T14:57:23:   sessionId: 'b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e'
2025-09-02T14:57:23: }
2025-09-02T14:57:32: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:32: 2025-09-02T21:57:32.852Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850252824-mfkwju', recordCount: 1 }
2025-09-02T14:57:32: 2025-09-02T21:57:32.852Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:32:   "userId": "user-1756847838064",
2025-09-02T14:57:32:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:32: }
2025-09-02T14:57:32: 2025-09-02T21:57:32.853Z üü¢ [FMB-SAML] FMB Authentication check for POST /api/time-entries {
2025-09-02T14:57:32:   "ip": "192.168.209.85:63610",
2025-09-02T14:57:32:   "sessionId": "b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e",
2025-09-02T14:57:32:   "isAuthenticated": true
2025-09-02T14:57:32: }
2025-09-02T14:57:32: 2025-09-02T21:57:32.853Z üü¢ [FMB-SAML] FMB Authentication successful {
2025-09-02T14:57:32:   "userId": "user-1756847838064",
2025-09-02T14:57:32:   "sessionId": "b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e"
2025-09-02T14:57:32: }
2025-09-02T14:57:32: üìù Time Entry Request Body: {
2025-09-02T14:57:32:   "projectId": "proj-1756847919444-2gxlcs5v0",
2025-09-02T14:57:32:   "taskId": "task-1756847930411-6l5o3ofkl",
2025-09-02T14:57:32:   "description": "",
2025-09-02T14:57:32:   "date": "2025-09-02",
2025-09-02T14:57:32:   "startTime": "13:57",
2025-09-02T14:57:32:   "endTime": "14:57",
2025-09-02T14:57:32:   "hours": 1,
2025-09-02T14:57:32:   "duration": 1
2025-09-02T14:57:32: }
2025-09-02T14:57:32: ‚úÖ Parsed Entry Data: {
2025-09-02T14:57:32:   "userId": "user-1756847838064",
2025-09-02T14:57:32:   "projectId": "proj-1756847919444-2gxlcs5v0",
2025-09-02T14:57:32:   "taskId": "task-1756847930411-6l5o3ofkl",
2025-09-02T14:57:32:   "description": "",
2025-09-02T14:57:32:   "hours": 1,
2025-09-02T14:57:32:   "duration": 1,
2025-09-02T14:57:32:   "date": "2025-09-02",
2025-09-02T14:57:32:   "startTime": "13:57",
2025-09-02T14:57:32:   "endTime": "14:57",
2025-09-02T14:57:32:   "status": "draft",
2025-09-02T14:57:32:   "billable": false,
2025-09-02T14:57:32:   "isBillable": false,
2025-09-02T14:57:32:   "isApproved": false,
2025-09-02T14:57:32:   "isManualEntry": true,
2025-09-02T14:57:32:   "isTimerEntry": false,
2025-09-02T14:57:32:   "isTemplate": false
2025-09-02T14:57:32: }
2025-09-02T14:57:32: üîÑ [SQL] 
2025-09-02T14:57:32:  operation on time_entries
2025-09-02T14:57:32: üóÑÔ∏è [SQL] Executing with 17 parameters
2025-09-02T14:57:32: ‚ùå [EXECUTE-exec-1756850252854-9y6flw] Query execution failed: {
2025-09-02T14:57:32:   error: "Cannot insert the value NULL into column 'user_id', table 'TimeTracker.dbo.time_entries'; column does not allow nulls. INSERT fails.",
2025-09-02T14:57:32:   code: 'EREQUEST',
2025-09-02T14:57:32:   number: 515,
2025-09-02T14:57:32:   severity: 16,
2025-09-02T14:57:32:   state: 2,
2025-09-02T14:57:32:   procedure: '',
2025-09-02T14:57:32:   lineNumber: 2,
2025-09-02T14:57:32:   query: '\n' +
2025-09-02T14:57:32:     '      INSERT INTO time_entries (id, user_id, project_id, task_id, description, hours,\n' +
2025-09-02T14:57:32:     '                               duration, date, start_time, end_time, status, billable,\n' +
2025-09-02T14:57:32:     '                          ',
2025-09-02T14:57:32:   paramCount: 17,
2025-09-02T14:57:32:   paramValues: [
2025-09-02T14:57:32:     'te-1756850252854-wih1rdver',
2025-09-02T14:57:32:     undefined,
2025-09-02T14:57:32:     undefined,
2025-09-02T14:57:32:     undefined,
2025-09-02T14:57:32:     '',
2025-09-02T14:57:32:     1,
2025-09-02T14:57:32:     1,
2025-09-02T14:57:32:     '2025-09-02',
2025-09-02T14:57:32:     undefined,
2025-09-02T14:57:32:     undefined,
2025-09-02T14:57:32:     'draft',
2025-09-02T14:57:32:     false,
2025-09-02T14:57:32:     false,
2025-09-02T14:57:32:     false,
2025-09-02T14:57:32:     true,
2025-09-02T14:57:32:     false,
2025-09-02T14:57:32:     false
2025-09-02T14:57:32:   ]
2025-09-02T14:57:32: }
2025-09-02T14:57:32: 2025-09-02T21:57:32.884Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query execution failed {
2025-09-02T14:57:32:   executeId: 'exec-1756850252854-9y6flw',
2025-09-02T14:57:32:   error: "Cannot insert the value NULL into column 'user_id', table 'TimeTracker.dbo.time_entries'; column does not allow nulls. INSERT fails.",
2025-09-02T14:57:32:   code: 'EREQUEST',
2025-09-02T14:57:32:   query: '\n' +
2025-09-02T14:57:32:     '      INSERT INTO time_entries (id, user_id, project_id, task_id, description, hours,\n' +
2025-09-02T14:57:32:     '             ...'
2025-09-02T14:57:32: }
2025-09-02T14:57:32: Error creating time entry: RequestError: Cannot insert the value NULL into column 'user_id', table 'TimeTracker.dbo.time_entries'; column does not allow nulls. INSERT fails.
2025-09-02T14:57:32:     at handleError (C:\fmb-timetracker\node_modules\mssql\lib\tedious\request.js:384:15)
2025-09-02T14:57:32:     at Connection.emit (node:events:518:28)
2025-09-02T14:57:32:     at Connection.emit (C:\fmb-timetracker\node_modules\tedious\lib\connection.js:970:18)
2025-09-02T14:57:32:     at RequestTokenHandler.onErrorMessage (C:\fmb-timetracker\node_modules\tedious\lib\token\handler.js:284:21)
2025-09-02T14:57:32:     at Readable.<anonymous> (C:\fmb-timetracker\node_modules\tedious\lib\token\token-stream-parser.js:19:33)
2025-09-02T14:57:32:     at Readable.emit (node:events:518:28)
2025-09-02T14:57:32:     at addChunk (node:internal/streams/readable:561:12)
2025-09-02T14:57:32:     at readableAddChunkPushObjectMode (node:internal/streams/readable:538:3)
2025-09-02T14:57:32:     at Readable.push (node:internal/streams/readable:393:5)
2025-09-02T14:57:32:     at nextAsync (node:internal/streams/from:194:22) {
2025-09-02T14:57:32:   code: 'EREQUEST',
2025-09-02T14:57:32:   originalError: Error: Cannot insert the value NULL into column 'user_id', table 'TimeTracker.dbo.time_entries'; column does not allow nulls. INSERT fails.
2025-09-02T14:57:32:       at handleError (C:\fmb-timetracker\node_modules\mssql\lib\tedious\request.js:382:19)
2025-09-02T14:57:32:       at Connection.emit (node:events:518:28)
2025-09-02T14:57:32:       at Connection.emit (C:\fmb-timetracker\node_modules\tedious\lib\connection.js:970:18)
2025-09-02T14:57:32:       at RequestTokenHandler.onErrorMessage (C:\fmb-timetracker\node_modules\tedious\lib\token\handler.js:284:21)
2025-09-02T14:57:32:       at Readable.<anonymous> (C:\fmb-timetracker\node_modules\tedious\lib\token\token-stream-parser.js:19:33)
2025-09-02T14:57:32:       at Readable.emit (node:events:518:28)
2025-09-02T14:57:32:       at addChunk (node:internal/streams/readable:561:12)
2025-09-02T14:57:32:       at readableAddChunkPushObjectMode (node:internal/streams/readable:538:3)
2025-09-02T14:57:32:       at Readable.push (node:internal/streams/readable:393:5)
2025-09-02T14:57:32:       at nextAsync (node:internal/streams/from:194:22) {
2025-09-02T14:57:32:     info: ErrorMessageToken {
2025-09-02T14:57:32:       name: 'ERROR',
2025-09-02T14:57:32:       handlerName: 'onErrorMessage',
2025-09-02T14:57:32:       number: 515,
2025-09-02T14:57:32:       state: 2,
2025-09-02T14:57:32:       class: 16,
2025-09-02T14:57:32:       message: "Cannot insert the value NULL into column 'user_id', table 'TimeTracker.dbo.time_entries'; column does not allow nulls. INSERT fails.",
2025-09-02T14:57:32:       serverName: 'FMB-SQLTST20-LV',
2025-09-02T14:57:32:       procName: '',
2025-09-02T14:57:32:       lineNumber: 2
2025-09-02T14:57:32:     }
2025-09-02T14:57:32:   },
2025-09-02T14:57:32:   number: 515,
2025-09-02T14:57:32:   lineNumber: 2,
2025-09-02T14:57:32:   state: 2,
2025-09-02T14:57:32:   class: 16,
2025-09-02T14:57:32:   serverName: 'FMB-SQLTST20-LV',
2025-09-02T14:57:32:   procName: '',
2025-09-02T14:57:32:   precedingErrors: []
2025-09-02T14:57:32: }
2025-09-02T14:57:32: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:32: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:32: 2025-09-02T21:57:32.953Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850252924-o7l97u', recordCount: 1 }
2025-09-02T14:57:32: 2025-09-02T21:57:32.954Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:32:   "userId": "user-1756847838064",
2025-09-02T14:57:32:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:32: }
2025-09-02T14:57:32: 2025-09-02T21:57:32.905Z üî¥ [FRONTEND-API] Request opim9dd8c exception {
2025-09-02T14:57:32:   data: {
2025-09-02T14:57:32:     requestId: 'opim9dd8c',
2025-09-02T14:57:32:     method: 'POST',
2025-09-02T14:57:32:     url: '/api/time-entries',
2025-09-02T14:57:32:     error: {
2025-09-02T14:57:32:       name: 'Error',
2025-09-02T14:57:32:       message: 'Failed to create time entry',
2025-09-02T14:57:32:       stack: 'Error: Failed to create time entry\n' +
2025-09-02T14:57:32:         '    at fe (https://timetracker.fmb.com/assets/index-DPbIIDG1.js:1:3142)'
2025-09-02T14:57:32:     }
2025-09-02T14:57:32:   },
2025-09-02T14:57:32:   url: 'https://timetracker.fmb.com/time-entry',
2025-09-02T14:57:32:   userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36 Edg/139.0.0.0',
2025-09-02T14:57:32:   ip: '192.168.209.85:63610',
2025-09-02T14:57:32:   sessionId: 'b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e'
2025-09-02T14:57:32: }
2025-09-02T14:57:32: 2025-09-02T21:57:32.957Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850252926-i0brip', recordCount: 1 }
2025-09-02T14:57:32: 2025-09-02T21:57:32.957Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:32:   "userId": "user-1756847838064",
2025-09-02T14:57:32:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:32: }
2025-09-02T14:57:32: 2025-09-02T21:57:32.904Z üî¥ [FRONTEND-API] Request opim9dd8c failed {
2025-09-02T14:57:32:   data: {
2025-09-02T14:57:32:     requestId: 'opim9dd8c',
2025-09-02T14:57:32:     method: 'POST',
2025-09-02T14:57:32:     url: '/api/time-entries',
2025-09-02T14:57:32:     status: 500,
2025-09-02T14:57:32:     error: { message: 'Failed to create time entry' },
2025-09-02T14:57:32:     duration: '100ms'
2025-09-02T14:57:32:   },
2025-09-02T14:57:32:   url: 'https://timetracker.fmb.com/time-entry',
2025-09-02T14:57:32:   userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36 Edg/139.0.0.0',
2025-09-02T14:57:32:   ip: '192.168.209.85:63610',
2025-09-02T14:57:32:   sessionId: 'b25fa038f2d5daf4743600e819e24b8bd5cb6eaf0b65007c9fa5550acf40c38e'
2025-09-02T14:57:32: }
2025-09-02T14:57:40: üóÑÔ∏è [SQL] Executing with 1 parameters
2025-09-02T14:57:40: 2025-09-02T21:57:40.184Z üóÑÔ∏è [FMB-STORAGE] EXECUTE: Query completed successfully { executeId: 'exec-1756850260156-ldul6y', recordCount: 1 }
2025-09-02T14:57:40: 2025-09-02T21:57:40.185Z üü¢ [FMB-SAML] User deserialized successfully {
2025-09-02T14:57:40:   "userId": "user-1756847838064",
2025-09-02T14:57:40:   "email": "Sravan.Modugula@fmb.com"
2025-09-02T14:57:40: }
